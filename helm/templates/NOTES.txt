{{/*
AIOps-Platform éƒ¨ç½²è¯´æ˜
æ–‡ä»¶: NOTES.txt
æè¿°: Helm Chartéƒ¨ç½²å®Œæˆåçš„ä½¿ç”¨è¯´æ˜å’Œè®¿é—®ä¿¡æ¯
ç‰ˆæœ¬: 1.0.0
ä½œè€…: AIOps Team
*/}}

ğŸ‰ AIOpså¹³å°å·²æˆåŠŸéƒ¨ç½²åˆ°Kubernetesé›†ç¾¤ï¼

ğŸ“‹ éƒ¨ç½²ä¿¡æ¯:
  - Releaseåç§°: {{ .Release.Name }}
  - å‘½åç©ºé—´: {{ .Release.Namespace }}
  - Chartç‰ˆæœ¬: {{ .Chart.Version }}
  - åº”ç”¨ç‰ˆæœ¬: {{ .Chart.AppVersion }}

ğŸŒ æœåŠ¡è®¿é—®åœ°å€:
{{- if .Values.ingress.enabled }}
{{- range $host := .Values.ingress.hosts }}
  * AIOpså¹³å°ä¸»é¡µ: {{ if $.Values.ingress.tls }}https{{ else }}http{{ end }}://{{ $host.host }}{{ $host.path }}
{{- end }}
{{- end }}

{{- if .Values.traefik.enabled }}
  * Traefikä»ªè¡¨æ¿: {{ if .Values.ingress.tls }}https{{ else }}http{{ end }}://{{ .Values.ingress.hosts | first | get "host" }}/traefik/
{{- end }}

{{- if .Values.grafana.enabled }}
  * Grafanaç›‘æ§é¢æ¿: {{ if .Values.ingress.tls }}https{{ else }}http{{ end }}://{{ .Values.ingress.hosts | first | get "host" }}/grafana/
    - ç”¨æˆ·å: admin
    - å¯†ç : kubectl get secret {{ include "aiops.fullname" . }}-grafana-admin -o jsonpath="{.data.password}" | base64 --decode
{{- end }}

{{- if .Values.prometheus.enabled }}
  * PrometheusæŒ‡æ ‡æŸ¥è¯¢: {{ if .Values.ingress.tls }}https{{ else }}http{{ end }}://{{ .Values.ingress.hosts | first | get "host" }}/prometheus/
{{- end }}

{{- if .Values.alertmanager.enabled }}
  * Alertmanagerå‘Šè­¦ç®¡ç†: {{ if .Values.ingress.tls }}https{{ else }}http{{ end }}://{{ .Values.ingress.hosts | first | get "host" }}/alertmanager/
{{- end }}

{{- if .Values.kibana.enabled }}
  * Kibanaæ—¥å¿—åˆ†æ: {{ if .Values.ingress.tls }}https{{ else }}http{{ end }}://{{ .Values.ingress.hosts | first | get "host" }}/kibana/
{{- end }}

{{- if .Values.aiEngine.enabled }}
  * AIå¼•æ“API: {{ if .Values.ingress.tls }}https{{ else }}http{{ end }}://{{ .Values.ingress.hosts | first | get "host" }}/ai/
    - APIæ–‡æ¡£: {{ if .Values.ingress.tls }}https{{ else }}http{{ end }}://{{ .Values.ingress.hosts | first | get "host" }}/ai/docs
{{- end }}

{{- if .Values.apiGateway.enabled }}
  * APIç½‘å…³: {{ if .Values.ingress.tls }}https{{ else }}http{{ end }}://{{ .Values.ingress.hosts | first | get "host" }}/api/
    - APIæ–‡æ¡£: {{ if .Values.ingress.tls }}https{{ else }}http{{ end }}://{{ .Values.ingress.hosts | first | get "host" }}/api/docs
{{- end }}

ğŸ”§ ç®¡ç†å‘½ä»¤:

1. æŸ¥çœ‹æ‰€æœ‰PodçŠ¶æ€:
   kubectl get pods -n {{ .Release.Namespace }}

2. æŸ¥çœ‹æœåŠ¡çŠ¶æ€:
   kubectl get svc -n {{ .Release.Namespace }}

3. æŸ¥çœ‹Ingressé…ç½®:
   kubectl get ingress -n {{ .Release.Namespace }}

4. æŸ¥çœ‹PVCå­˜å‚¨:
   kubectl get pvc -n {{ .Release.Namespace }}

5. æŸ¥çœ‹æ—¥å¿—:
   kubectl logs -f deployment/{{ include "aiops.fullname" . }}-<component> -n {{ .Release.Namespace }}

6. ç«¯å£è½¬å‘ï¼ˆæœ¬åœ°è®¿é—®ï¼‰:
{{- if .Values.grafana.enabled }}
   kubectl port-forward svc/{{ include "aiops.fullname" . }}-grafana 3000:3000 -n {{ .Release.Namespace }}
{{- end }}
{{- if .Values.prometheus.enabled }}
   kubectl port-forward svc/{{ include "aiops.fullname" . }}-prometheus 9090:9090 -n {{ .Release.Namespace }}
{{- end }}
{{- if .Values.kibana.enabled }}
   kubectl port-forward svc/{{ include "aiops.fullname" . }}-kibana 5601:5601 -n {{ .Release.Namespace }}
{{- end }}

ğŸ“Š ç›‘æ§å’Œå‘Šè­¦:

{{- if .Values.prometheus.enabled }}
- Prometheusæ­£åœ¨æ”¶é›†ä»¥ä¸‹ç»„ä»¶çš„æŒ‡æ ‡:
{{- if .Values.traefik.enabled }}
  âœ“ Traefik (ç½‘ç»œæµé‡å’Œè·¯ç”±)
{{- end }}
{{- if .Values.elasticsearch.enabled }}
  âœ“ Elasticsearch (æœç´¢å’Œå­˜å‚¨)
{{- end }}
{{- if .Values.redis.enabled }}
  âœ“ Redis (ç¼“å­˜æ€§èƒ½)
{{- end }}
{{- if .Values.postgresql.enabled }}
  âœ“ PostgreSQL (æ•°æ®åº“æ€§èƒ½)
{{- end }}
{{- if .Values.aiEngine.enabled }}
  âœ“ AIå¼•æ“ (æ¨¡å‹æ¨ç†å’Œå¼‚å¸¸æ£€æµ‹)
{{- end }}
{{- if .Values.apiGateway.enabled }}
  âœ“ APIç½‘å…³ (è¯·æ±‚å¤„ç†å’Œå“åº”æ—¶é—´)
{{- end }}
{{- if .Values.selfHealing.enabled }}
  âœ“ è‡ªæ„ˆæ‰§è¡Œå™¨ (ä¿®å¤æ“ä½œå’ŒæˆåŠŸç‡)
{{- end }}
{{- end }}

{{- if .Values.alertmanager.enabled }}
- å‘Šè­¦é€šçŸ¥å·²é…ç½®:
{{- if .Values.alertmanager.config.global.smtp_smarthost }}
  âœ“ é‚®ä»¶é€šçŸ¥ (SMTP: {{ .Values.alertmanager.config.global.smtp_smarthost }})
{{- end }}
{{- if .Values.alertmanager.config.global.slack_api_url }}
  âœ“ Slacké€šçŸ¥
{{- end }}
  âœ“ Webhooké€šçŸ¥ (è‡ªæ„ˆè§¦å‘)
{{- end }}

ğŸ” å®‰å…¨ä¿¡æ¯:

{{- if .Values.elasticsearch.auth.enabled }}
- Elasticsearchè®¤è¯:
  ç”¨æˆ·å: elastic
  å¯†ç : kubectl get secret {{ include "aiops.fullname" . }}-elasticsearch-auth -o jsonpath="{.data.password}" | base64 --decode
{{- end }}

{{- if .Values.redis.auth.enabled }}
- Redisè®¤è¯:
  å¯†ç : kubectl get secret {{ include "aiops.fullname" . }}-redis-auth -o jsonpath="{.data.password}" | base64 --decode
{{- end }}

{{- if .Values.postgresql.enabled }}
- PostgreSQLè®¤è¯:
  ç”¨æˆ·å: {{ .Values.postgresql.auth.username | default "postgres" }}
  æ•°æ®åº“: {{ .Values.postgresql.auth.database | default "aiops" }}
  å¯†ç : kubectl get secret {{ include "aiops.fullname" . }}-postgresql-auth -o jsonpath="{.data.password}" | base64 --decode
{{- end }}

ğŸš€ å¿«é€Ÿå¼€å§‹:

1. ç­‰å¾…æ‰€æœ‰Podå¯åŠ¨å®Œæˆ:
   kubectl wait --for=condition=ready pod --all -n {{ .Release.Namespace }} --timeout=300s

2. è®¿é—®GrafanaæŸ¥çœ‹ç³»ç»Ÿç›‘æ§:
   - æ‰“å¼€æµè§ˆå™¨è®¿é—®Grafanaåœ°å€
   - ä½¿ç”¨adminè´¦æˆ·ç™»å½•
   - æŸ¥çœ‹é¢„é…ç½®çš„AIOpsä»ªè¡¨æ¿

3. æŸ¥çœ‹æ—¥å¿—åˆ†æ:
   - è®¿é—®Kibanaåœ°å€
   - é…ç½®ç´¢å¼•æ¨¡å¼ (logstash-*)
   - å¼€å§‹åˆ†æåº”ç”¨æ—¥å¿—

4. æµ‹è¯•AIå¼‚å¸¸æ£€æµ‹:
   - è®¿é—®AIå¼•æ“APIæ–‡æ¡£
   - å‘é€æµ‹è¯•æ•°æ®è¿›è¡Œå¼‚å¸¸æ£€æµ‹
   - æŸ¥çœ‹æ£€æµ‹ç»“æœå’Œå»ºè®®

5. é…ç½®è‡ªæ„ˆè§„åˆ™:
   - è®¿é—®APIç½‘å…³æ–‡æ¡£
   - åˆ›å»ºè‡ªå®šä¹‰å‘Šè­¦è§„åˆ™
   - é…ç½®è‡ªåŠ¨ä¿®å¤åŠ¨ä½œ

ğŸ“š æ›´å¤šä¿¡æ¯:

- é¡¹ç›®æ–‡æ¡£: https://github.com/your-org/aiops-platform
- APIå‚è€ƒ: {{ if .Values.ingress.tls }}https{{ else }}http{{ end }}://{{ .Values.ingress.hosts | first | get "host" }}/api/docs
- é—®é¢˜åé¦ˆ: https://github.com/your-org/aiops-platform/issues

{{- if .Values.global.development }}
âš ï¸  å¼€å‘æ¨¡å¼è­¦å‘Š:
å½“å‰éƒ¨ç½²å¤„äºå¼€å‘æ¨¡å¼ï¼ŒæŸäº›å®‰å…¨ç‰¹æ€§å¯èƒ½è¢«ç¦ç”¨ã€‚
ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è¯·è®¾ç½® global.development=false
{{- end }}

æ„Ÿè°¢ä½¿ç”¨AIOpsæ™ºèƒ½è¿ç»´å¹³å°ï¼ğŸ¯